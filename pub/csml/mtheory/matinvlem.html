<!doctype html> <html lang=en > <meta charset=UTF-8 > <meta name=viewport  content="width=device-width, initial-scale=1"> <link rel=stylesheet  href="/libs/katex/katex.min.css"> <link rel=stylesheet  href="/css/main.css"> <link rel=icon  href="/assets/infra/favicon.png"> <title>Matrix inversion lemmas</title> <header> <div class=blog-name ><a href="/">Thibaut Lienart</a></div> <nav> <ul> <li><a href="/">Home</a> <li><a href="/pub/csml.html">CS/ML notes</a> <li><a href="/pub/julia.html">Julia notes</a> <li><a href="/pub/misc.html">Misc.</a> </ul> <img src="/assets/infra/hamburger.svg" id=menu-icon > </nav> </header> <div class=jd-content > <h1>Matrix inversion lemmas</h1> <p>The <em>Woodbury formula</em> is maybe one of the most ubiquitous trick in basic linear algebra: it starts with the explicit formla for the inverse of a block 2x2 matrix and results in identities that can be used in kernel theory, the Kalman filter, to combine multivariate normals etc.</p> <h2>Partitioned matrix inversion</h2> <p>Consider an invertible matrix \(M\) made of invertible blocks \(A\), \(B\), \(C\) and \(D\) with appropriate dimensions. Then, the inverse of \(M\) can be written as</p> $$ M \quad\!\! =\quad\!\! \begin{pmatrix} A & B \\ C & D \end{pmatrix} \quad\!\! \text{and}\quad\!\! M^{-1} \quad\!\! =\quad\!\! \begin{pmatrix} W & X \\ Y& Z \end{pmatrix}, $$ <p>for some \(W\), \(X\), \(Y\) and \(Z\) to be determined. Clearly, we need to have \(MM^{-1} = \mathbf I\) since \(M\) is assumed to be invertible, this gives:</p> $$ \begin{cases} AW + BY &=\quad\!\! \mathbf I \\ AX + BZ &=\quad\!\! \mathbf 0 \\ CW + DY &=\quad\!\! \mathbf 0 \\ CX + DZ &=\quad\!\! \mathbf I \end{cases} $$ <p>Solving that system using \(A^{-1} B^{-1} = (BA)^{-1}\), we get</p> $$ \begin{cases} W &=\quad\!\! (A - BD^{-1} C)^{-1} \\ Y &=\quad\!\! -D^{-1} CW \\ Z &=\quad\!\! (D-CA^{-1} B)^{-1} \\ X &=\quad\!\! -A^{-1} B Z \end{cases} $$ <h3>Basic lemmas</h3> <p>We started with \(MM^{-1} = \mathbf I\) but we could have started with \(M^{-1} M=\mathbf I\) of course. This gives an equivalent result but the form obtained for \(Y\) and \(X\) is different:</p> $$ \begin{cases} Y &=\quad\!\! -ZCA^{-1}\\ X &=\quad\!\! -WBD^{-1} \end{cases} $$ <p>Equating the expressions for \(Y\) gives \(D^{-1} CW = ZCA^{-1}\) from which we get the first lemma.</p> <div class=colbox-blue >&#40;<strong>Lemma I</strong>&#41; the following identity holds for matrices \(A\), \(B\), \(C\) and \(D\) of appropriate dimensions: $$ (A-BD^{-1} C)^{-1} \quad\!\! =\quad\!\! C^{-1} D(D-CA^{-1} B)^{-1} CA^{-1}, $$ assuming \(A\), \(C\), \(D\) and \((A-BD^{-1} C)\) are invertible.</div> <p>Equating the expressions for \(X\) gives \(A^{-1} B Z = WBD^{-1}\) from which we get the second lemma.</p> <div class=colbox-blue >&#40;<strong>Lemma II</strong>&#41; the following identity holds: $$ A^{-1} B(D-CA^{-1} B)^{-1} \quad\!\! =\quad\!\! (A-BD^{-1} C)^{-1} BD^{-1} $$ with the same assumptions as for lemma I.</div> <h3>Woodbury formula</h3> <p>In the right-hand side of lemma I, if we replace the left factor \(C^{-1} D\) by \(C^{-1}(D-CA^{-1} B)\) and adjust accordingly, we get the <strong>Woodbury formula</strong> &#40;also known as the <em>Sherman-Morrison-Woodbury formula</em>&#41;.</p> <div class=colbox-blue >&#40;<strong>Woodbury formula</strong>&#41; the following identity holds: $$ (A-BD^{-1} C)^{-1} \quad\!\! =\quad\!\! A^{-1} + A^{-1} B (D-CA^{-1} B)^{-1} CA^{-1} $$ with the same assumptions as for lemma I.</div> <div class=page-foot > <div class=copyright > &copy; T. Lienart. Last modified: December 11, 2018. Website built with <a href="https://github.com/tlienart/JuDoc.jl">JuDoc.jl</a>. </div> </div> </div> <script src="/libs/katex/katex.min.js"></script> <script src="/libs/katex/auto-render.min.js"></script> <script>renderMathInElement(document.body)</script>